<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="iap_account_view_form" model="ir.ui.view">
        <field name="name">gatewayapi.iap.account.view.form</field>
        <field name="model">iap.account</field>
        <field name="inherit_id" ref="iap.iap_account_view_form" />
        <field name="arch" type="xml">
            <!-- GatewayAPI settings -->
            <xpath expr="//group[@name='account']" position="after">
                <group
                    string="GatewayAPI account"
                    name="group_sms_api_gatewayapi"
                    invisible="provider != 'sms_api_gatewayapi'"
                >
                    <group col="1">
                        <group>
                            <div class="o_form_label"><b>Service Name</b></div>
                            <field name="service_name" string="Service Name" placeholder="sms" help="Service Name must be 'sms' for GatewayAPI integration."/>
                        </group>
                        <group>
                            <div class="o_form_label"><b>GatewayAPI Base URL</b></div>
                            <field name="gatewayapi_base_url" string="GatewayAPI Base URL" required="provider == 'sms_api_gatewayapi'"/>
                        </group>
                        <group>
                            <div class="o_form_label"><b>Sender Name</b></div>
                            <field name="gatewayapi_sender" string="Sender Name" required="provider == 'sms_api_gatewayapi'"/>
                        </group>
                        <group>
                            <div class="o_form_label"><b>API Token</b></div>
                            <field name="gatewayapi_api_token" string="API Token" password="True" widget="password" options='{"show_password": true}' required="provider == 'sms_api_gatewayapi'"/>
                        </group>
                        <group>
                            <div class="o_form_label"><b>Balance</b></div>
                            <field name="gatewayapi_balance" string="Balance" readonly="1"/>
                        </group>
                        <button name="gatewayapi_connection_test" string="Test Connection" type="object" class="oe_highlight" style="width:auto; min-width:0; display:inline-block;"/>
                        <group>
                            <div class="o_form_label"><b>Connection Status</b></div>
                            <field name="gatewayapi_connection_status" invisible="gatewayapi_connection_status == False" readonly="True"/>
                        </group>
                        <group>
                            <div class="o_form_label"><b>Check for minimum credits</b></div>
                            <field name="gatewayapi_check_min_tokens"/>
                        </group>
                        <div class="o_form_label">
                            When enabled, you will receive an e-mail notification if your credits fall below the minimum.
                        </div>
                        <group modifiers='{"invisible": [["gatewayapi_check_min_tokens", "=", false]]}'>
                            <field name="gatewayapi_min_tokens"/>
                            <field name="gatewayapi_cron_interval_number"/>
                            <field name="gatewayapi_cron_interval_type"/>
                        </group>
                    </group>
                </group>
            </xpath>

            <!-- Chatter -->
            <xpath expr="//sheet" position="after">
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </xpath>
        </field>
    </record>

    <record id="iap_account_view_tree_gatewayapi" model="ir.ui.view">
        <field name="name">gatewayapi.iap.account.view.tree</field>
        <field name="model">iap.account</field>
        <field name="inherit_id" ref="iap.iap_account_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="gatewayapi_balance"/>
            </xpath>
        </field>
    </record>
</odoo>